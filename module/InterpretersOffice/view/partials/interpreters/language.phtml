<?php 
/**
 * module/InterpretersOffice/view/partials/interpreters/language.phtml
 * 
 * this is intended to keep the HTML in one place and the Javascript simple
 * for rendering/dynamically adding languages to the Interpreter form
 * 
 * expected variables are either:
 *  
 *  (1) $this->count and $this->collection
 *     or
 *  (2) a $this->language entity and an index number $this->index
 */

if ($this->language) : 
    $this->count = 1;   // counter for the `for` loop
endif;

for ($i = 0; $i < $this->count; $i++) :
    
    if ($this->collection) { // rendering existing languages
        
        $fs = $this->collection->get($i);        
        $language_element = $fs->get('language');
        $this->language = $language_element->getValue();
        $certifiable = $this->language->isFederallyCertified();
        $language_id = $this->language->getId();
        $language_element->setValue($language_id);
        
        $certification_element = $fs->get('federalCertification');
        $certification_element->setAttribute('id',"fed-certification-{$i}");  
        
        
    } else { // XHR request for some markup
        
        $i = $this->index;
        $certifiable = $this->language->isFederallyCertified();
        $language_id = $this->language->getId();
        // don't know why the FUCK I can't get these initialized
        // with constructor options. grrrr!!!
        $language_element = (new \Zend\Form\Element\Hidden(
            "interpreter[interpreterLanguages][$i][language]"                
        ))->setValue($language_id);           
        $certification_element = new \Zend\Form\Element\Select(                
                "interpreter[interpreterLanguages][$i][federalCertification]"            
         );
        $certification_element->setAttributes([
            'class' => 'form-control',
            'id'=>"fed-certification-{$i}"
        ]);
        $empty_label = $certifiable ? '' : "N/A";
        $value_options = ['-1' =>  $empty_label, 1 => 'yes', 0 => 'no', ];
        $certification_element->setValueOptions($value_options);
    }        
    if (! $certifiable) :
        // federal certification is not applicable
        $certification_element->setAttribute('disabled','disabled');
    endif; // now, the markup
    
    ?><div class="col-sm-offset-1 col-sm-3  interpreter-language language-name" id="language-<?php echo $language_id ?>">
        <?php 
        echo $this->formElement($language_element),  $this->escapeHtml($this->language->getName());
        ?>
    </div>
    <div class="col-sm-5 form-inline interpreter-language language-certification">
        <label for="fed-certification-<?php echo $i ?>">fed certification:</label>
    <?php echo $this->formElement($certification_element); 
       ?><button class="btn btn-warning btn-xs btn-remove-language" title="remove this language"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
            <span class="sr-only">remove language</span></button>
        <?php if ($certification_element->getAttribute('disabled')) : // supply a value, to avoid undefined index error  ?>
            <input type="hidden" name="interpreter[interpreterLanguages][<?php echo $i ?>][federalCertification]" value="-1">
    <?php endif; ?>
        <div class="alert alert-warning validation-error" style="display:none"></div>                
    </div>
<?php endfor;?>

