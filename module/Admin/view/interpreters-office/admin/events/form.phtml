<?php
use InterpretersOffice\Admin\Form\View\Helper\InterpreterElementCollection;

$this->headTitle('admin | events | '.$this->layout()->action);
$this->headLink()->appendStylesheet($this->basePath('css/jquery-bootstrap-datepicker.css'));
$this->headScript()
        ->appendFile($this->basePath('js/lib/modernizr-custom.js'))
        ->appendFile($this->basePath('js/lib/jquery-ui/jquery-ui.min.js'))
        ->appendFile($this->basePath('js/lib/moment/min/moment.min.js'))
        ->appendFile($this->basePath('js/event-form.js'));
if ($this->errorMessage) : ?>
<div class="alert alert-danger"><?php echo $this->errorMessage ?></div>
<?php
return;
endif;
$form = $this->form; 
$form->setAttribute('class','form-horizontal form-event');
$form->add([
    'name' => 'submit',
    'type' => 'Zend\Form\Element\Submit',
     'attributes' => ['value' => 'save','class'=>'btn btn-success btn-lg'],
])->setAttribute('method', 'post');
?>
<h2><?php echo $this->navigation('default')->breadcrumbs() ?></h2>
<?php

$form->prepare();
$fieldset = $form->get('event');
// for testing
if (true) {
    $fieldset->get('time')->setValue('10:00:00');
    $fieldset->get('date')->setValue('2017-08-15');
    $fieldset->get('judge')->setValue(949);
    $fieldset->get('eventType')->setValue(1);
    $fieldset->get('language')->setValue(62);
    $fieldset->get('parent_location')->setValue(1);
    $fieldset->get('interpretersAssigned')->populateValues([  
   ['interpreter'=> 117] 
]);
}
/*
class Helper extends \Zend\View\Helper\AbstractHelper {
    public function render($fieldset) {
        return 'rendering '.get_class($fieldset).'<br>';
    }
}*/
//$this->formCollection()->setFieldsetHelper(new Helper);


echo $this->form()->openTag($form);  

//var_dump(get_class_methods($collection));

?>
<div class="col-sm-6"><!-- left side -->
    <div class="row">
        <?php foreach (['date','time','judge','eventType','parent_location','location','language','docket',
            ] as $elementName) : $element = $fieldset->get($elementName); ?>
            <div class="form-group">
                <label class="control-label col-sm-3" for="<?= $element->getAttribute('id') ?>"><?= $element->getLabel() ?></label>
                <div class="col-sm-9"><?= $this->formElement($element) ?><?= $this->formElementErrors($element) ?></div>
            </div>
        <?php endforeach; ?>
    </div>
</div>
<div class="col-sm-6"><!-- right side -->
    <div class="row">
        <div class="form-group">
            <label class="control-label col-sm-3" for="interpreter-select">interpreters</label>
            <div class="col-sm-9">
                <?php echo $this->formElement($fieldset->get('interpreter-select'));?>
                <ul style="margin-top: 1em" id="interpreters-assigned" class="list-group interpreters-assigned">
                <?php 
                
                /* 'interpretersAssigned' is a Element\Collection, each of 
                 * whose elements is a InterpretersAssignedFieldset 
                 * containing its own elements.                   
                */
                $collection = $fieldset->get('interpretersAssigned'); 
                $helper = (new InterpreterElementCollection())->setView($this);
                echo $helper->render($collection);
                ?>
                </ul>
            </div>
        </div>
        <?php foreach ([] as $elementName) : $element = $fieldset->get($elementName); ?>
            <div class="form-group">
                <label class="control-label col-sm-3" for="<?= $element->getAttribute('id') ?>"><?= $element->getLabel() ?></label>
                <div class="col-sm-9"><?= $this->formElement($element) ?><?= $this->formElementErrors($element) ?></div>
            </div>
        <?php endforeach; ?>
    </div>
</div>
<div style="margin-top:1em" class="form-group">
            <div class="col-sm-offset-3 col-sm-9">
                <?php
               // $csrf = $form->get('csrf');
               // echo $this->formHidden($csrf),$this->formElementErrors($csrf) ;
               // echo $this->formHidden($fieldset->get('id'));
                echo $this->formSubmit($form->get('submit'));?>
            </div>       
        </div><!-- / .form-group -->
<?php echo $this->form()->closeTag(); ?>

