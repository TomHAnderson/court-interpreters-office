<?php
/** module/Admin/views/interpreters-offe/admin/interpreters/index.phtml
 *  viewscript for main people-administration page
 */
$this->headScript()->appendFile($this->basePath('js/lib/jquery-ui/jquery-ui.min.js'));
$this->headLink()->appendStylesheet('//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.css') ?>
$form = $this->form;
foreach (['language_id','active','security_clearance_expiration'] as $e) :
    $form->get($e)->setValue($this->params[$e]);
endforeach;
$form->get('name')->setValue(key_exists('name',$this->params)? $this->params['name']:'');
$this->headTitle($this->title);
//$form->setData(['language_id'=>1,'active'=> 0,'security_clearance_expiration'=>1]);
?>
<h2>interpreters</h2>
<?php
$messenger = $this->flashMessenger()->setAutoEscape(false);
if ($messenger->hasSuccessMessages()) :
    echo $messenger->render('success', ['alert','alert-success',]);
endif;
?>
<form>
    <div class="form-group form-inline">
    <div id="form-errors" class="alert alert-warning hidden"></div>
    Find interpreters of
        <label for="language" class="sr-only">language</label> <?php echo $this->formElement($form->get('language_id'))?>
        who are <label for="active" class="sr-only">status</label>
        <?php echo $this->formSelect($form->get('active'))?>
        with security clearance <label for="security_clearance_expiration" class="sr-only">security clearance</label>
         <?php echo $this->formSelect($form->get('security_clearance_expiration'))?><!--
    --><a id="btn-search-language" href="<?php echo $this->url('interpreters') ?>" class="btn btn-success"><span class="glyphicon glyphicon-search"></span> search</a> 
    </div>
    <div class="form-group form-inline">or whose name is <?php echo $this->formElement($form->get('name'))?><a href="<?php echo $this->url('interpreters')?>" id="btn-search-name" class="btn btn-success"><span class="glyphicon glyphicon-search"></span> search</a></div> 
</form>
<br>
<?php 
if ($this->data): 
    echo $this->paginationControl($this->data, null, 'partials/pagination_head'); 
?>

<table class="table table-hover table-bordered" style="max-width:700px">
    <tbody>
        <?php
        foreach ($this->data as $row) :
            $interpreter = $row[0];  ?>
        <tr><td><?php echo $this->escapeHtml(sprintf('%s, %s',$interpreter->getLastname(),$interpreter->getFirstname())) ?></td><td></td></tr>
<?php  endforeach;  ?>
    </tbody>
</table>
<p>TO DO: action menu thingy for each table row, e.g: edit, view, cron, email</p>
<?php echo $this->paginationControl(
    $this->data,
    'sliding',
    'partials/pagination_control',
     ['route'=>$this->routeName,'params'=>$this->params]     
);?>
<?php 
    else : 
        if ($this->isQuery) :
?><p>No matching records found.</p><?php 
    endif; 
endif; ?>
<a href="<?php echo $this->url('interpreters/add') ?>" role="button" title="add a new interpreter" id="btn-add-interpreter" class="btn btn-info">
<span aria-hidden="true" class="icon glyphicon glyphicon-plus"></span> new interpreter
</a>

<!-- <pre><?php print_r($this->params)?></pre> -->

<script type="text/javascript">
$(function(){
    
    console.log("boink! loaded");
    var languageSelect = $('#language_id'); 
    var languageButton = $('#btn-search-language');
    languageButton.on("click",function(event){
        event.preventDefault();
        var language_id = languageSelect.val() || "0";  
        var url = languageButton.attr('href');
        url += '/language/' + language_id;        
        url += '/active/'+$('#active').val();                
        var security = $('#security_clearance_expiration').val();
        //if (security !== "-1") {
        // no, do this unconditionally because if no value is submitted for 
        // this, the session value overrides and this doesn't stick
            url += '/security/'+security;
        //}
        document.location = url;
    });
    $('#name').autocomplete({
        source : window.basePath+'/admin/interpreters',
        minLength : 2,
        focus: function( event, ui ) {}
    });
    $('#btn-search-name').on("click",function(event){
        event.preventDefault();
        var nameElement = $('#name');
        var name = nameElement.val();
        if (! name) {
            return;
        }
        
        
        
    });
});

</script>