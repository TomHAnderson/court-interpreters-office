<?php
/** module/Admin/views/interpreters-offe/admin/interpreters/index.phtml
 *  viewscript for main people-administration page
 */

$form = $this->form;
foreach (['language_id','active','security_clearance_expiration'] as $e) :
    $form->get($e)->setValue($this->params[$e]);
endforeach;
$form->get('name')->setValue(key_exists('name',$this->params)? $this->params['name']:'');
$this->headTitle($this->title);
//$form->setData(['language_id'=>1,'active'=> 0,'security_clearance_expiration'=>1]);
?>
<h2>interpreters</h2>
<?php
$messenger = $this->flashMessenger()->setAutoEscape(false);
if ($messenger->hasSuccessMessages()) :
    echo $messenger->render('success', ['alert','alert-success',]);
endif;

?>
<form>
    <div class="form-group form-inline">
    <div id="form-errors" class="alert alert-warning hidden"></div>
    Find interpreters of
        <label for="language" class="sr-only">language</label> <?php echo $this->formElement($form->get('language_id'))?>
        who are <label for="active" class="sr-only">status</label>
        <?php echo $this->formSelect($form->get('active'))?>
        with security clearance <label for="security_clearance_expiration" class="sr-only">security clearance</label>
         <?php echo $this->formSelect($form->get('security_clearance_expiration'))?><!--
    --><a id="btn-search-language" href="<?php echo $this->url('interpreters') ?>" class="btn btn-success"><span class="glyphicon glyphicon-search"></span> search</a> 
    </div>
    <div class="form-group form-inline">or whose name is <?php echo $this->formElement($form->get('name'))?><a href="#" class="btn btn-success"><span class="glyphicon glyphicon-search"></span> search</a></div> 
</form>
<a href="<?php echo $this->url('interpreters/add') ?>" role="button" title="add a new interpreter" id="btn-add-interpreter" class="btn btn-info">
<span aria-hidden="true" class="icon glyphicon glyphicon-plus"></span> new interpreter
</a>
<?php system("echo shit") ?>
This has Ramón Núñez in it<br>  
<?php if ($this->data): ?>
<?php echo get_class($this->data). " is our data type<br>" ?>
<?php foreach ($this->data as $row) {
    //echo ($row['hat'] . " "); //break;
    $interpreter = $row[0];
    echo $interpreter->getLastname(), " ",$interpreter->getId(),"<br>";
    //echo gettype($row[1]); break;
}
?>

<?php else : echo " NO data ";endif; ?>
    
<pre><?php print_r($this->params)?></pre>

<script type="text/javascript">
$(function(){
    
    console.log("boink! loaded");
    var languageSelect = $('#language_id'); 
    var languageButton = $('#btn-search-language');
    languageButton.on("click",function(event){
        event.preventDefault();
        var language_id = languageSelect.val() || "0";  
        var url = languageButton.attr('href');
        url += '/language/' + language_id;        
        url += '/active/'+$('#active').val();                
        var security = $('#security_clearance_expiration').val();
        //if (security !== "-1") {
        // no, do this unconditionally because if no value is submitted for 
        // this, the session value overrides and this doesn't stick
            url += '/security/'+security;
        //}
        document.location = url;
    });
});

</script>