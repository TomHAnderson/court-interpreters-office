<?php /** module/Admin/view/interpreters-office/admin/schedule/view.phtml  */
$this->headScript()
->appendFile($this->basePath('js/event-delete.js'))
->appendFile($this->basePath('js/event-view.js'));
//->appendFile($this->basePath('js/lib/sweetalert2.min.js'))
//$this->headLink()->appendStylesheet($this->basePath('css/sweetalert2.css'));
//$this->headStyle()->captureStart();?><?php //$this->headStyle()->captureEnd();
/**
 *
 * @var \InterpretersOffice\Entity\Event $event
 */
$event = $this->event;
$this->entity = $event; // hint the Diff helper
if (! $event) :  ?>
    <p class="alert alert-warning">event not found!</p>
    <?php
    return;
endif;
$this->headTitle('event details');
// figure out location
if ($event['location']) :
    $IS_DEFAULT_LOCATION = false;
    $location = $event['location'];
    if ($event['parent_location']) :
        $location .= ', '.$event['parent_location'];
    endif;
elseif ($event['category'] == 'in' && $event['default_courtroom']) :
    // fall back on judge default
    $IS_DEFAULT_LOCATION = true;
    $location = $event['default_courtroom'];
    if ($event['default_courthouse']) :
        $location .= ', '.$event['default_courthouse'];
    endif;
    $location .= ' <span class="text-muted text-md-right">**</span>';
else :
    $location = '';
    $IS_DEFAULT_LOCATION = null;
endif;
?>
<h2 class="navigation pt-1 mx-auto my-4 text-center"><a href="/admin">admin</a> | <a href="/admin/schedule">schedule</a> <small class="text-muted text-md-right">event details</small></h2>
<?php
$messenger = $this->flashMessenger();
if ($messenger->hasSuccessMessages()) :
    echo $messenger->render('success', ['alert','alert-success',], false);
elseif ($messenger->hasErrorMessages()) :
    echo $messenger->render('danger', ['alert','alert-danger',], false);
endif;?>
<!-- experimental debug zone -->
<pre><?php
$session = new \Zend\Session\Container('event_updates');
//print_r(array_keys($this->entity));
if ($session->{$event['id']}) {
    $this->before = $session->{$event['id']};
    unset($session->{$event['id']});
}
?></pre>
<!-- TO DO: make partials for flat-out details and for "diff"
    and use one or the other, depending
-->
<div data-event_id="<?php echo $event['id']?>" class="row event-details mx-auto border p-2 shadow-sm" style="max-width:900px">
    <div class="col-sm-3 text-muted text-md-right">
        date
    </div>
    <div class="col-sm-3 pl-0">
        <?php echo $this->diff('date')?>
    </div>
    <div class="col-sm-3 text-muted text-md-right">
        time
    </div>
    <div class="col-sm-3 pl-0 time">
        <?php echo $this->diff('time') ?: '<em>?</em>' ?>
    </div>
    <div class="col-sm-3 text-muted text-md-right">
        type
    </div>
    <div class="col-sm-3 pl-0">
        <?php echo $this->diff('type') ?>
    </div>
    <div class="col-sm-3 text-muted text-md-right">
        language
    </div>
    <div class="col-sm-3 pl-0">
        <?php echo $this->diff('language')?>
    </div>
    <div class="col-sm-3 text-muted text-md-right">
        judge
    </div>
    <div class="col-sm-3 pl-0">
        <?php echo $this->diff('judge');
        if ($event['aj_default_location']) :
            ?> <span class="text-muted"><?php echo $event['aj_default_location']?></span><?php
        endif; ?>
    </div>
    <div class="col-sm-3  text-muted text-md-right">
        location
    </div>
    <div class="col-sm-3 pl-0">
        <?php echo $this->diff('location') ?>
    </div>
    <div class="col-sm-3 text-muted text-md-right">
        defendants
    </div>
    <div class="col-sm-3  defendants pl-0"><?php
        echo $this->diff('defendants');
    ?>
    </div>
    <div class="col-sm-3  text-muted text-md-right">
        docket
    </div>
    <div class="col-sm-3 pl-0">
        <?php echo $this->diff('docket') ?>
    </div>
    <div class="col-sm-3  text-muted text-md-right">
        interpreters
    </div>
    <div class="col-sm-3 pl-0 interpreters"><?php
        echo $this->diff('interpreters');
    ?>
    </div>
    <div class="col-sm-3 text-muted text-md-right">
        cancellation
    </div>
    <div class="col-sm-3 pl-0">
        <?php echo $this->diff('reason_for_cancellation') ;//?: '<span class="text-muted">n/a</span>'?>
    </div>
        <div class="col-sm-3  text-muted text-md-right">
        <?php if ($event['request_id']):?>* <?php endif ?>request by
    </div>
    <div class="col-sm-3 pl-0"><span class="avoidwrap">
        <?php echo $event['submitter'] ;
        ?><?php
if ($event['submitter_hat']) :
    ?>,</span> <span class="avoidwrap"><?php
    echo $this->diff('submitter_hat');
endif;?></span>
    </div>
    <div class="col-sm-3 text-muted text-md-right">
        requested on
    </div>
    <div class="col-sm-3 pl-0">
    <?php
    if ($event['request_id']):
        printf('%s %s',
        $event['submission_date']->format('d-M-Y'),
        $event['submission_time']->format('g:i a')
        );
    else:
        printf('%s %s',
            $this->diff('submission_date'),
            $this->diff('submission_time')
        );
    endif;

    ?>
    </div>
    <div class="col-sm-3 text-muted text-md-right">
        created
    </div>
    <div class="col-sm-3 pl-0">
        <?php echo $event['created']->format('d-M-Y g:i a'), " ({$event['created_by']})"; ?>
    </div>
    <div class="col-sm-3 text-muted text-md-right">
        last updated
    </div>
    <div class="col-sm-3 pl-0">
        <?php echo $event['created'] != $event['last_updated'] ?
        "{$this->diff('last_updated')} ({$this->diff('last_updated_by')})"
        : '<span class="text-muted">n/a</span>';
        ?>
    </div>
<?php if ($event['submitter_comments']): ?>
    <div class="col-sm-3 text-muted text-md-right">
        submitter comments
    </div>
    <div class="col-sm-9 pl-0">
        <?php echo nl2br($this->escapeHtml($event['submitter_comments'])) ?>
    </div>
<?php endif; ?>
    <div class="col-sm-3 text-muted text-md-right">
        comments (public)
    </div>
    <div class="col-sm-9 pl-0">
        <?php //echo nl2br($this->escapeHtml($event['comments']))
        echo nl2br($this->diff('comments'))
        ?>
    </div>
    <div class="col-sm-3 text-muted text-md-right">
        comments (internal)
    </div>
    <div class="col-sm-9 pl-0">
        <?php echo nl2br($this->diff('admin_comments'));
        if ($event['submitter_extra_data'] and
            isset($event['submitter_extra_data']['defendants'])): ?>
            <div class="extra-deft-names text-muted mt-0 pt-0">
                The submitter did not find defendant name(s) in your database:<br>
                <ul><li>
                <?php echo implode('</li><li>',
                    $event['submitter_extra_data']['defendants']);
                ?></li></ul>
            </div>
        <?php endif; ?>
    </div>

    <div class="col-12 d-flex">
        <div class="btn-group mx-auto" role="group" aria-label="available actions">
          <a href="<?php echo $this->url('events/edit', ['id' => $event['id']])?>" role="button" class="btn btn-success">edit</a>
          <a href="<?php echo $this->url('events/add', ['id' => $event['id']]);?>" role="button" class="btn btn-success">repeat</a>
          <a data-csrf="<?php echo $this->csrf ?>" href="<?php echo $this->url('events/edit', ['action' => 'delete',  'id' => $event['id']])?>" id="btn-delete" role="button" class="btn btn-success">delete</a>
        </div>

    </div>
    <?php if ($event['request_id'] or true === $IS_DEFAULT_LOCATION): ?>
        <div class="col-sm-9 pl-0 offset-sm-3  text-muted border-bottom-0" style=font-size:90%;>
            <?php if ($event['request_id']):?>* this was submitted online<br><?php endif; ?>
            <?php if ($event['location'] and true === $IS_DEFAULT_LOCATION):?>** default location, not specified by the user<?php endif; ?>
        </div>
    <?php endif ?>
</div>
<!-- -->
<!-- -->
