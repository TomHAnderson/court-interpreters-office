<?php
$action = $this->layout()->action;
$is_index = !in_array($action,['edit','create']);
$this->headTitle($is_index?"MOTD|MOTW":"$action $this->type");
$this->headScript()->appendFile($this->basePath('js/admin/notes-form.js'));?>
<h2><?php echo $this->navigation('admin-breadcrumbs')->breadcrumbs() ?></h2>
<?php $settings = $this->layout()->note_settings;
$date_obj = new \DateTimeImmutable($settings['date']);
$dow = (int)$date_obj->format('w');
if ($dow != 1) {
    $interval = sprintf('P%sD',$dow - 1);
    $this->monday = $date_obj->sub(new \DateInterval($interval));
}
?>
<h4><?php echo $date_obj->format('D d-M-Y')?></h4>
<pre hidden>
    type:  <?php var_dump($this->type) ?>
    module? <?php var_dump($this->layout()->module)?>
    action: <?php var_dump($action) ?>
    monday: <?php print_r($this->monday) ?>
    notes_display (layout): <?php var_dump($this->layout()->display_notes) ?>
    notes_display: <?php var_dump($this->display_notes) ?>
    date setting is <?php echo $settings['date'] ?> -->
    $this->notes['motd'] is a : <?php echo gettype($this->notes['motd']) ?>
</pre>
<ul class="nav nav-tabs" id="tabs-notes" role="tablist">
  <li class="nav-item">
    <a class="nav-link<?php if (!$this->type or 'motd' == $this->type):?> active<?php endif ?>" id="day-tab" data-toggle="_tab" href="#day" role="tab" aria-controls="day" aria-selected="true">MOTD</a>
  </li>
  <li class="nav-item">
    <a class="nav-link<?php if ('motw' == $this->type): ?> active<?php endif ?>" id="week-tab" data-toggle="_tab" href="#week" role="tab" aria-controls="week" aria-selected="false">MOTW</a>
  </li>
</ul>
<div class="tab-content" id="tab-content-notes">
  <div class="tab-pane pt-2<?php if (!$this->type or 'motd' == $this->type):?> show active<?php endif?>" id="day" role="tabpanel" aria-labelledby="day-tab">
      <div class="row">
         <div class="col-md-8">
            <?php
              if (!$is_index && $this->type=='motd'):
                  echo $this->partial('notes/partials/form.phtml',[
                      'date'=>$this->date,'type'=>$this->type,'note'=> $this->{$this->type},
                       'csrf'=>$this->csrf,'action' =>$action,
                  ]);
              else:
                if ($this->notes['motd']): $motd = $this->notes['motd'];
                    echo $motd->getContent();
                  ?>
                  <a href="<?php echo $this->url('notes/edit',['type'=>'motd','date'=>$motd->getDate()->format('Y-m-d') ,
                    'id'=>$motd->getId()])?>" role="button" id="btn-edit-motd" class="btn btn-primary fas fa-edit text-light"><span class="sr-only">edit</span></a><?php
                else:
                  ?><p class="font-italic no-note">no MOTD for this date</p>
                  <button id="btn-create-motd" class="btn btn-primary fas fa-edit"><span class="sr-only">create</span></button><?php
                endif;
            endif;?>
        </div>
        <div class="notes-calendar" data-date="<?php echo $settings['date']?>" id="calendar-motd" class="col">
        </div>
    </div>
</div>
<!--  ===============================================================-->
<div class="tab-pane pt-2<?php if ('motw' == $this->type):?> show active<?php endif?>" id="week" role="tabpanel" aria-labelledby="week-tab">
    <div class="row">
        <div class="col-md-8"><?php
        if (!$is_index && $this->type=='motw'):
            echo $this->partial('notes/partials/form.phtml',[
                'date'=>$this->date,'type'=>$this->type,
                'note'=> $this->{$this->type},
                'csrf'=>$this->csrf,'action' =>$action,
            ]);
        else:
            if ($this->notes['motw']): $motw = $this->notes['motw']; echo $motw->getContent();
            ?><a href="<?php echo $this->url('notes/edit',['type'=>'motw','date'=>$motw->getDate()->format('Y-m-d') , 'id'=>$motw->getId()])?>" role="button" id="btn-edit-motd" class="btn btn-primary fas fa-edit text-light"><span class="sr-only">edit</span></a><?php
              else:
            ?><p class="font-italic no-note">no MOTW for this week</p>
                <button id="btn-create-motd" class="btn btn-primary fas fa-edit"><span class="sr-only">create</span></button><?php
              endif;
          endif;?>

        </div>
        <div class="notes-calendar" data-date="<?php if ($this->notes['motw']): echo $this->notes['motw']->getDate()->format('Y-m-d');
        else : echo $this->monday->format('Y-m-d'); endif?>" id="calendar-motw" class="col"></div>
    </div>
</div>
</div>
<script>
    // var btn = document.getElementById('btn-edit-motd');
    // btn.addEventListener("click",(e)=>{
    //     console.log("click!");
    //     console.log(typeof $);
    // }
    // );
</script>
