<?php
/** module/Requests/view/interpreters-office/requests/index/list.phtml
*
*   view script for displaying user's interpreter requests
*/
$this->headScript()
    ->appendFile($this->basePath('js/lib/moment/min/moment.min.js'))
    ->appendFile($this->basePath('js/requests/list.js'))
    ;
$this->headTitle('requests | list') ?>
<div id="content">
<h2><?php echo $this->navigation('Zend\Navigation\RequestsBreadcrumbs')->breadcrumbs() ?></h2>
<?php
$messenger = $this->flashMessenger();
if ($messenger->hasSuccessMessages()) :
    echo $messenger->render('success', ['alert','alert-success',], false);
endif;
?>
<div class="alert alert-warning alert-dismissible" id="error-div" style="display:none; max-width:600px">
    <div id="error-message"></div>
    <button type="button" class="close" data-dismiss="alert" aria-label="close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
<?php
if ($this->paginator && $this->paginator->getTotalItemCount()):
    ?><p>
        <?php echo $this->paginationControl($this->paginator, null, 'partials/pagination_head');?>
    </p>
<table id="requests-table" data-deadline="<?php echo $this->deadline ?>" class="table table-sm">
    <caption class="sr-only">list of interpreter requests</caption>
    <thead></thead>
    <tbody>
    <?php
        foreach ($this->paginator as $r):
            $docket = $r['docket'] ? substr($r['docket'],2) : '';
            $location = $r['location'] ? $r['location']['name']  : '';
        ?><tr data-request_id="<?php echo $r['id']?>">
            <td><span class="avoidwrap"><?php echo $r['date']->format('d-M-Y')?></span></td>
            <td class="d-md-none d-lg-table-cell"><?php echo $r['time']->format('g:i a')?></td>
            <td><?php echo $r['language']['name']?></td>
            <td><?php echo $r['eventType']['name']?></td>
            <td><?php echo $location ?></td>
            <td class="d-md-none d-lg-table-cell"><?php echo $docket ?></td>
            <td><?php echo $r['judge']['lastname']?></td>
            <td><?php echo $this->defendants($r['id'])?></td>
            <td class="dropleft"><a style="color:purple" id="request-dropdown-<?php echo $r['id']?>" href="javascript:void(0)" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="sr-only">actions</span><span class="fas fa-bars"></span></a>
              <div class="dropdown-menu" aria-labelledby="request-dropdown-<?php echo $r['id']?>">
                <a title="display detailed view of this request" class="dropdown-item request-details text-primary" href="<?php echo $this->url('requests/view',['id'=>$r['id']])?>">show details</a>
                <div class="dropdown-divider"></div>
                <a title="modify or withdraw this request" class="dropdown-item request-update disabled" href="<?php echo $this->url('requests/update',['id'=>$r['id']])?>">edit</a>
                <div class="dropdown-divider"></div>
                <a title="schedule an interpreter for another event in this same case" class="dropdown-item request-repeat text-primary" href="<?php echo $this->url('requests/create',['id'=>$r['id']])?>">repeat</a>
              </div>
            </td>
        </tr><?php
        endforeach;
    ?>
    </tbody>
</table>
<?php echo $this->paginationControl(
    $this->paginator,'sliding', 'partials/pagination_control',['route' => 'requests/list']
);?>
<?php else: $url =  $this->url('requests/create');?>
<p class="alert alert-warning">You have no electronically submitted interpreter requests
in the database. To create one please go to <a href="<?php echo $url?>"><?php echo $url?></a>.</p>
<?php endif;?>
</div>
