<?php
if ($this->results):
    if (!count($this->results)):?>
<p>We found no records matching the above criteria.</p>
    <?php return; endif;
?>
<pre><?php // print_r($this->layout()->user)?></pre>
<p>
    <?php echo $this->paginationControl($this->results, null, 'partials/pagination_head');?>
</p>
<table class="table table-sm">
    <tbody>
        <?php  $view = $this; foreach ($this->results as $r): //$e = $r[0];?>
            <tr>
                <td><?php echo $r[0]['date']->format('d-M-Y')?></td>
                <td><?php echo $this->escapeHtml($r['language']) ?></td>
                <td><?php echo $this->escapeHtml($r['type']); ?></td>
                <td><?php echo $this->escapeHtml($r[0]['docket']) ?></td>
                <td><?php echo $this->escapeHtml($r['judge'])?></td>
                <td><?php
                    $defts = $r[0]['defendants'];
                    if ($defts) :
                        echo implode('<br>',array_map(function($d) use ($view)
                        { return $view->escapeHtml("{$d['surnames']}, {$d['given_names']}");},
                        $defts));
                    endif;
                ?></td>
                <td></td>
            </tr>
        <?php endforeach; ?>
    </tbody>
</table>
<?php
    echo $this->paginationControl($this->results,'sliding',
        'partials/pagination_control',['route' => 'requests/search']);
endif;
